<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Heian Era StoryMap - Japan History</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body {
      font-family: 'Georgia', serif;
      background-color: #f5f1e8;
      margin: 0;
      color: #333;
    }
    .header {
      background: linear-gradient(135deg, #8b4513 0%, #d2691e 100%);
      color: #fff;
      padding: 24px 18px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,.2);
    }
    .container {
      display: flex;
      gap: 18px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px;
      flex-wrap: wrap;
    }
    #map {
      flex: 2;
      min-width: 320px;
      height: 400px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }
    .sidebar {
      flex: 1;
      min-width: 240px;
      background: white;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.09);
    }
    .sidebar h2 {
      color: #8b4513;
      margin-bottom: 14px;
      border-bottom: 2px solid #d2691e;
      padding-bottom: 8px;
    }
    .timeline-item {
      margin-bottom: 13px;
      padding-bottom: 13px;
      border-left: 3px solid #d2691e;
      padding-left: 14px;
      font-size: 0.92em;
    }
    .legend {
      margin-bottom: 16px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }
    .legend-icon {
      width: 23px;
      height: 23px;
      margin-right: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.15em;
    }
    .icon-capital { background: #8b0000;}
    .icon-temple { background: #228b22;}
    .icon-battle { background: #ff6347;}
    .icon-culture { background: #4169e1;}
    @media (max-width: 900px) {
      .container { flex-direction: column; }
      #map { height: 300px; }
      .sidebar { max-height: 320px; }
    }
    @media (max-width: 600px) {
      .sidebar, #map { min-width: 100%; }
      #map { height: 220px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>‚õ©Ô∏è Heian Era StoryMap</h1>
    <p>Interactive History of Japan's Classical Period (794-1185)</p>
  </div>
  <div class="container">
    <div id="map"></div>
    <div class="sidebar" id="sidebar"></div>
  </div>

  <!-- React/ReactDOM/Babel CDN (development mode) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script type="text/babel">
    function Sidebar() {
      return (
        <div>
          <div className="legend">
            <h3>üìç Map Legend</h3>
            <div className="legend-item"><div className="legend-icon icon-capital">üèØ</div><span>Capital & Center</span></div>
            <div className="legend-item"><div className="legend-icon icon-temple">üèõÔ∏è</div><span>Temple & Religious Site</span></div>
            <div className="legend-item"><div className="legend-icon icon-culture">üéé</div><span>Cultural Landmark</span></div>
            <div className="legend-item"><div className="legend-icon icon-battle">‚öîÔ∏è</div><span>Battle Site</span></div>
          </div>
          <h2>üìÖ Timeline</h2>
          <div className="timeline-item">
            <strong>794 Establishment</strong><br/>
            Emperor Kanmu moves the capital to Heian-ky≈ç (Kyoto), starting Heian era.
          </div>
          <div className="timeline-item">
            <strong>9th‚Äì10th Century: Fujiwara Regency</strong><br/>
            Fujiwara clan controls imperial court‚Äîgolden age of arts and literature.
          </div>
          <div className="timeline-item">
            <strong>11th Century: Cultural Peak</strong><br/>
            Tale of Genji, poetry, and aesthetics reach zenith.
          </div>
          <div className="timeline-item">
            <strong>1156 H≈çgen Rebellion</strong><br/>
            First major military conflict between samurai clans.
          </div>
          <div className="timeline-item">
            <strong>1185 Genpei War Ends</strong><br/>
            Dan-no-ura naval battle, Minamoto defeats Taira, end of Heian period.
          </div>
        </div>
      );
    }

    function App() {
      React.useEffect(() => {
        // Leaflet map setup
        const map = L.map('map').setView([35.0116, 135.7681], 7);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '¬© OpenStreetMap contributors',
          maxZoom: 19
        }).addTo(map);

        // Emoji marker (custom icon)
        function createIcon(emoji, color) {
          return L.divIcon({
            html: `<div style="background:${color};border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;font-size:18px;border:2px solid #fff;">${emoji}</div>`,
            iconSize: [32,32], className: ''
          });
        }

        // Locations
        const locations = [
          {
            name: "Heian-ky≈ç (Kyoto)", coord: [35.0116, 135.7681], icon: createIcon('üèØ', '#8b0000'),
            popup: `<strong>Heian-ky≈ç</strong><br>The Imperial Capital (794-1868)<br>Founded by Emperor Kanmu in 794.`
          },
          {
            name: "By≈çd≈ç-in Temple", coord: [34.8898, 135.8072], icon: createIcon('üèõÔ∏è', '#228b22'),
            popup: `<strong>By≈çd≈ç-in Temple</strong><br>Architectural masterpiece of Heian era.`
          },
          {
            name: "Mount Hira & Enryaku-ji", coord: [35.1019, 135.8561], icon: createIcon('üèõÔ∏è', '#228b22'),
            popup: `<strong>Enryaku-ji Temple</strong><br>Major Buddhist temple with Heian power.`
          },
          {
            name: "Kinkaku-ji (Golden Pavilion)", coord: [35.0394, 135.7294], icon: createIcon('üéé', '#4169e1'),
            popup: `<strong>Kinkaku-ji</strong><br>Architecture and beauty reflect Heian achievements.`
          },
          {
            name: "Dan-no-ura", coord: [34.2167, 131.6000], icon: createIcon('‚öîÔ∏è', '#ff6347'),
            popup: `<strong>Dan-no-ura</strong><br>Naval battle that ended the Genpei War (1185).`
          },
          {
            name: "Fushimi Inari", coord: [34.8673, 135.7629], icon: createIcon('‚õ©Ô∏è', '#228b22'),
            popup: "<strong>Fushimi Inari Shrine</strong><br>Important Shinto shrine during Heian era."
          },
          {
            name: "Ise Grand Shrine", coord: [34.4867, 136.7194], icon: createIcon('‚õ©Ô∏è', '#228b22'),
            popup: "<strong>Ise Grand Shrine</strong><br>Most sacred Shinto shrine in Japan."
          }
        ];

        locations.forEach(loc => {
          L.marker(loc.coord, {icon: loc.icon}).addTo(map).bindPopup(loc.popup);
        });

        // Genpei War route line
        L.polyline([[35.0116,135.7681],[35.1019,135.8561],[34.2167,131.6000]], {
          color: '#ff6347', weight: 2, opacity:.5, dashArray:'4,3'
        }).addTo(map).bindPopup('Genpei War Campaign Route (1180-1185)');

        // Mobile resize
        window.addEventListener('resize', () => {
          map.invalidateSize();
        });

        // Cleanup for SPA/React (not strictly required here)
        return () => { map.remove(); };
      }, []);

      return (
        <>
          <Sidebar />
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById('sidebar')).render(<App />);
  </script>
</body>
</html>